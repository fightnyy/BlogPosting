### S3

* Simple Storage Service의 약자로서 객체스토리지 서비스입니다(쉽게 파일저장 서비스라고 생각하셔도 됩니다)
* 무제한 용량을 갖고 있습니다
* Bucket 이라는 단위로 구분합니다.
* 버전 관리(VC) 가 가능합니다.
* 정적 웹 호스팅이 가능합니다.
* 업로드와 업데이트/삭제의 데이터 일관성 모델이 다릅니다.
* 여러 티어로 구성됩니다.
* 암호화가 가능합니다.
* 보안 설정이 가능합니다.
* 다른 유저/ 다른계정과 공유가 가능합니다.
* 다른 Region으로 복제가 가능합니다.
* 수명 주기 설정이 가능합니다.
* 삭제 방지 기능이 제공됩니다.
* 파일 전송 Transfer Acceleration이 가능합니다.
* Athena/Macie 등의 서비스로 Query 및 검증이 가능합니다.



이제 해당 내용에 대한 설명을 하나하나 드리겠습니다.

##### 객체스토리지 서비스

* Block Storage Service(EBS, EFS등)
  * 파일 설치가 불가능합니다. 즉, 파일을 실행시킬수 가 없습니다. 이런 서비스를 이용하기 위해선 EBS, EFS등을 살펴보셔야 합니다.



##### 무제한 용량

* 단 하나의 객체는 즉, 단 하나의 파일은 0byte 에서 5TB의 용량 제한이 있습니다.
  * 뭐야? 무제한 용량이라며! => 하나의 파일에만 용량 제한이 있는것이지 5TB인 파일을 2000개 업로드 하는것이 가능합니다.



##### Bucket 이라는 단위로 구분

* Bucket = 디렉토리 라고 생각하셔도 됩니다.
* Bucket 이름은 전 세계적으로 중복된 이름을 가져선 안됩니다.(Global Unique)
* Web Hosting시 도메인과 Bucket 명이 같아야 합니다.



##### 버전관리 지원

* 모든 버전을 관리(삭제 포함)합니다.
* 활성화를 해야 작동합니다. 즉 초기값으로는 비활성화 상태입니다.
  * 한번 활성화시 비활성화를 할 수 없습니다.
* 수명 주기 관리와 연동이 가능합니다.



##### 정적웹 호스팅이 가능합니다.

* 기본적으로 파일은 두가지 웹 URL을 가지고 있습니다.
  * https://bucket-name.s3.Region.amazonaws.com/keyname
  * https://s3.Region.amazonaws.com/bucket-name/keyname
* HTML/JS 등으로 구성된 Static(데이터가 변하지 않는) 사이트만 가능 -> React 등
* 호스팅 비용이 (비교적) 저렴함
* Serverless 구성의 기초
* 동적인 데이터는 AJAX 등으로 해결 가능



##### 일관성 모델

* Put(새로 생성) : 읽기 후 쓰기(Read After Write -> 이름을 잘못지은거 같습니다 ㅠㅠ 쓰기 후 읽기가 더 맞아보이는데......)
  * 파일을 올리고 성공한 즉시 읽기가 가능합니다
  * 먼저 Put 한 요청이 우선권을 가집니다
* Update / Delete : 최종 일관성(Eventual Consistency)
  * 파일을 삭제하거나 업데이트 후 일정 시간 후에 결과가 반영됩니다.(1초미만)
  * 원자성 확보가 불가능합니다.



##### S3 티어

* S3 - Standard
  * 가장 기초적인 S3 티어 입니다.
  * 여러 장소에 분산하여 파일을 저장합니다.
* S3 - IA (Infrequently Accessed)
  * 자주 사용 되지 않는 데이터를 저렴한 가격에 보관합니다.
  * 데이터를 불러올 때마다 비용을 지불 합니다.
  * 언제사용되나요? => 오래된 데이터들이나 사용자의 접근이 거의 없는 데이터에 사용되면 효과적으로 요금을 운영할 수 있습니다
* S3 - One Zone IA
  *  IA와 같으나 하나의 AZ에만 저장됨
  * 덜 중요하고 자주 사용되지 않는 데이터
  * 언제사용되나요? => 원본이미지의 섬네일에 사용할 수 있습니다.
* S3 - Intellignet Tiering
  * 머신 러닝을 사용해 자동으로 티어변경
  * 퍼포먼스 손해/오버헤드 없음
* S3 - Glacier
  * 아카이브용 저장소
  * 저렴한 가격
  * 데이터를 가져오는데 분 ~ 시간 단위의 시간이 소요
*  S3 - Glacier Deep Archive
  * 매우 쌈
  * 데이터를 가져오는데 12시간 정도 필요함



##### 보안설정

* Bucket Policy
  * 파일 단위로 설정이 되는것이 아닌 버킷 단위로 설정이 됩니다.
  * JSON 형식으로 제공됩니다.
* ![image-20210508192053464](/Users/nayeong-yun/Library/Application Support/typora-user-images/image-20210508192053464.png)
  * 버전은 문법이 언제버전인지를 나타내는 요소입니다.
  * id는 버킷 policy의 id 입니다, 고유 ID를 나타냅니다.
  * Sid 는 Statement의 id를 나타냅니다.
  * Effect는 Allow(허락), Deny(부정)
  * Principal은 누구에게 적용을 할지 나타내는 것입니다. 해당 예제에서 보면 IAM에 spark라는 유저에게 적용된다는 의미입니다.
  * Action은 해당 버킷Policy에서 해당하는 여러가지 액션을 말해줍니다. 
    * GetObject : 객체를 가져오는 액션
    * GetBucketLocation : 객체의 위치를 가져오는 명령어
    * ListBucket : 모든 버킷 리스트들을 확인하는 액션
  * Resource는 어떤 리소스에 해당할 것인지 나타냅니다.
    * arn은 고유한 id 입니다. AWS에 있는 모든 리소스는 arn이라는 id를 가집니다.
  * 

<br>

### S3 API

* 파일 관련 API(업로드, 업데이트, 삭제 등)
  * 업로드 성공시 HTTP 200코드 반환
  * 큰 용량의 파일의 경우 Multipart Upload 가능(개당 5Gb) -> 만약 1GB 인 파일을 900 MB 까지 받다가 연결이 끊기면 처음부터 다시 받야 하는데 해당 파일을 여러 part로 나눠 진행하면 이런 문제가 완화됩니다.
  * 다운로드는 Torrent 지원





### S3 객체의 구성

* Key : 파일의 이름
* Value : 파일의 데이터
* Version Id : 파일의 버전 아이디
* Metadata : 파일의 정보를 담은 데이터
* ACL : 파일의 권한을 담은 데이터
* Torrents : 토렌트 공유를 위한 데이터 